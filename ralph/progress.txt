
## 2026-02-02 - TRC-013
- Verified presence of ASI07-ASI10 attack templates in `src/knowledge/agent_seed_data.py` (30 templates total).
- Fixed retrieval bug in `src/knowledge/agent_attacks.py` where multi-tag templates were filtered out due to imprecise thresholding.
- Refactored `AgentAttackKnowledgeBase` to use `_deserialize_template` for consistent validation and error handling.
- Implemented security fixes:
  - Redacted OWASP codes in error messages to prevent metadata injection.
  - Capped query `k` to prevent amplification attacks.
  - Added array integrity checks for ChromaDB results.
  - Improved executor lifecycle management.
- Fixed race condition handling in `seed_agent_attacks` (now handles overwrite/stats correctly).
- Achieved 100% pass rate on 18 tests, 83% coverage.
- Reviews completed: code-reviewer, silent-failure-hunter, security, code-simplifier.
- **Learnings for future iterations:**
  - **ChromaDB**: `add` with `PersistentClient` may overwrite existing IDs without raising exception (acting like upsert). Explicit existence check is needed if you want "skipped" stats.
  - **Metadata Filtering**: When filtering primarily by metadata (e.g. `get_attacks_by_capability`), set `threshold=-1.0` to ensure semantic similarity doesn't filter out relevant hits.
  - **Error Messages**: Never echo untrusted input (like metadata fields) back in error messages without redaction/sanitization.
  - **Refactoring**: When extracting methods (like `_deserialize_template`), verify access to module-level constants (`_OWASP_BY_VALUE`).
---
